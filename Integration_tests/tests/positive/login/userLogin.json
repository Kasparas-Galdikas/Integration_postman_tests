{
  "info": {
    "name": "positive - login - userLogin",
    "_postman_id": "pos-login-single-test",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
    "description": "Pozityvus prisijungimo testas: registruoja vartotojÄ…, prisijungia, tikrina statusÄ…, JSON formatÄ…, struktÅ«rÄ…, laukus ir kad password nÄ—ra grÄ…Å¾inamas."
  },
  "item": [
    {
      "name": "Prisijungimas â€“ sÄ—kmÄ— (POST /login)",
      "event": [
        {
          "listen": "prerequest",
          "script": {
            "type": "text/javascript",
            "exec": [
              "// ðŸ”§ DinaminÄ—s reikÅ¡mÄ—s, kad testas bÅ«tÅ³ kartotinas",
              "const id = Date.now();",
              "pm.collectionVariables.set('loginUsername', `user_pos_login_${id}`);",
              "pm.collectionVariables.set('loginFullName', 'User Positive Login');",
              "pm.collectionVariables.set('loginEmail', `poslogin_${id}@example.com`);",
              "pm.collectionVariables.set('loginPassword', 'secret1');",
              "",
              "// Numatytasis baseUrl, jei nepaduotas",
              "if (!pm.environment.get('baseUrl') && !pm.collectionVariables.get('baseUrl')) {",
              "  pm.collectionVariables.set('baseUrl', 'http://localhost:3000');",
              "}",
              "",
              "// UÅ¾registruojame vartotojÄ…, kad login bÅ«tÅ³ sÄ—kmingas",
              "const base = pm.environment.get('baseUrl') || pm.collectionVariables.get('baseUrl');",
              "pm.sendRequest({",
              "  url: `${base}/register`,",
              "  method: 'POST',",
              "  header: { 'Content-Type':'application/json' },",
              "  body: {",
              "    mode: 'raw',",
              "    raw: JSON.stringify({",
              "      username: pm.collectionVariables.get('loginUsername'),",
              "      fullName: pm.collectionVariables.get('loginFullName'),",
              "      email: pm.collectionVariables.get('loginEmail'),",
              "      password: pm.collectionVariables.get('loginPassword')",
              "    })",
              "  }",
              "}, (err, res) => {",
              "  // Registracija Äia vyksta prieÅ¡ login; jei ji nepavyktÅ³ â€“ pats login turÄ—tÅ³ kristi.",
              "});"
            ]
          }
        },
        {
          "listen": "test",
          "script": {
            "type": "text/javascript",
            "exec": [
              "// 1) Status kodas",
              "pm.test('Status 200 (OK)', () => pm.response.to.have.status(200));",
              "",
              "// 2) JSON formatas (leidÅ¾ia ; charset=utf-8)",
              "pm.test('Content-Type yra JSON', () => {",
              "  const ctype = pm.response.headers.get('Content-Type');",
              "  pm.expect(ctype).to.match(/^application\\/json\\b/i);",
              "});",
              "const body = pm.response.json();",
              "",
              "// 3) StruktÅ«ra: message, user",
              "pm.test('Atsakymas turi message ir user laukus', () => {",
              "  pm.expect(body).to.have.property('message');",
              "  pm.expect(body).to.have.property('user');",
              "});",
              "",
              "// 4) User laukai ir jokio password",
              "pm.test('user turi username/email/fullName ir neturi password', () => {",
              "  pm.expect(body.user).to.have.property('username');",
              "  pm.expect(body.user).to.have.property('email');",
              "  pm.expect(body.user).to.have.property('fullName');",
              "  pm.expect(body.user).to.not.have.property('password');",
              "});",
              "",
              "// 5) GrÄ…Å¾intos reikÅ¡mÄ—s sutampa su registruotomis",
              "pm.test('GrÄ…Å¾intos reikÅ¡mÄ—s sutampa su registruotomis', () => {",
              "  pm.expect(body.user.username).to.eql(pm.collectionVariables.get('loginUsername'));",
              "  pm.expect(body.user.email).to.eql(pm.collectionVariables.get('loginEmail'));",
              "  pm.expect(body.user.fullName).to.eql(pm.collectionVariables.get('loginFullName'));",
              "});",
              "",
              "// 6) Teisingas endpoint (saugumo patikra)",
              "pm.test('Naudojamas teisingas endpoint (/login)', () => {",
              "  const path = pm.request.url.getPath();",
              "  pm.expect(path).to.match(/\\/login$/);",
              "});"
            ]
          }
        }
      ],
      "request": {
        "method": "POST",
        "header": [
          { "key": "Content-Type", "value": "application/json" }
        ],
        "url": {
          "raw": "{{baseUrl}}/login",
          "host": ["{{baseUrl}}"],
          "path": ["login"]
        },
        "body": {
          "mode": "raw",
          "raw": "{\n  \"username\": \"{{loginUsername}}\",\n  \"password\": \"{{loginPassword}}\"\n}"
        },
        "description": "Prisijungimo sÄ—kmÄ—s scenarijus."
      },
      "response": []
    }
  ],
  "variable": [
    { "key": "baseUrl", "value": "http://localhost:3000" }
  ]
}
