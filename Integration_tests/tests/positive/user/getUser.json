{
  "info": {
    "name": "positive - user - getUser",
    "_postman_id": "pos-user-get",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
    "description": "Pozityvus GET /user/:username testas su deep validation: tikslūs laukai, strict struktūra, XSS escape, trim tikrinimas."
  },
  "item": [
    {
      "name": "Gauti vartotoją – sėkmė (GET /user/:username)",
      "event": [
        {
          "listen": "prerequest",
          "script": {
            "type": "text/javascript",
            "exec": [
              "// Sugeneruojame unikalias reikšmes",
              "const id = Date.now();",
              "pm.collectionVariables.set('u_username', `user_pos_get_${id}`);",
              "pm.collectionVariables.set('u_fullName_raw', '   <script>alert(1)</script>   ');",
              "pm.collectionVariables.set('u_email', `posget_${id}@example.com`);",
              "pm.collectionVariables.set('u_password', 'secret1');",
              "",
              "// Tikrasis escaped + trimmed variantas (pagal express-validator.escape())",
              "const expectedEscaped = '&lt;script&gt;alert(1)&lt;&#x2F;script&gt;';",
              "pm.collectionVariables.set('u_fullName_expected', expectedEscaped);",
              "",
              "// Užtikriname baseUrl",
              "if (!pm.environment.get('baseUrl') && !pm.collectionVariables.get('baseUrl')) {",
              "  pm.collectionVariables.set('baseUrl', 'http://localhost:3000');",
              "}",
              "const base = pm.environment.get('baseUrl') || pm.collectionVariables.get('baseUrl');",
              "",
              "// Registruojame vartotoją prieš GET",
              "pm.sendRequest({",
              "  url: `${base}/register`,",
              "  method: 'POST',",
              "  header: { 'Content-Type':'application/json' },",
              "  body: {",
              "    mode:'raw',",
              "    raw: JSON.stringify({",
              "      username: pm.collectionVariables.get('u_username'),",
              "      fullName: pm.collectionVariables.get('u_fullName_raw'),",
              "      email: pm.collectionVariables.get('u_email'),",
              "      password: pm.collectionVariables.get('u_password')",
              "    })",
              "  }",
              "});"
            ]
          }
        },
        {
          "listen": "test",
          "script": {
            "type": "text/javascript",
            "exec": [
              "// 1) Status 200",
              "pm.test('Status 200', () => pm.response.to.have.status(200));",
              "",
              "// 2) JSON formatas",
              "pm.test('Content-Type yra JSON', () => {",
              "  pm.expect(pm.response.headers.get('Content-Type')).to.match(/^application\\/json\\b/i);",
              "});",
              "",
              "const user = pm.response.json();",
              "",
              "// 3) TIK 3 laukų grąžinimas",
              "pm.test('User turi TIK 3 laukus', () => {",
              "  pm.expect(Object.keys(user)).to.have.members(['username', 'email', 'fullName']);",
              "});",
              "",
              "// 4) Visiškai nėra password visame atsakyme",
              "pm.test('Atsakyme apskritai nėra password', () => {",
              "  pm.expect(pm.response.text().toLowerCase()).to.not.include('password');",
              "});",
              "",
              "// 5) STRICT equality tikrinimas",
              "pm.test('Strict equality: visi laukai sutampa', () => {",
              "  pm.expect(user).to.eql({",
              "    username: pm.collectionVariables.get('u_username'),",
              "    email: pm.collectionVariables.get('u_email'),",
              "    fullName: pm.collectionVariables.get('u_fullName_expected')",
              "  });",
              "});",
              "",
              "// 6) Escape test",
              "pm.test('FullName escape teisingas', () => {",
              "  pm.expect(user.fullName).to.equal(pm.collectionVariables.get('u_fullName_expected'));",
              "});",
              "",
              "// 7) Trim test",
              "pm.test('FullName neturi whitespace prieš/po', () => {",
              "  pm.expect(user.fullName.startsWith(' ')).to.be.false;",
              "  pm.expect(user.fullName.endsWith(' ')).to.be.false;",
              "});",
              "",
              "// 8) Endpoint correctness",
              "pm.test('Naudojamas teisingas user endpoint', () => {",
              "  pm.expect(pm.request.url.getPath()).to.match(/\\/user\\//);",
              "});"
            ]
          }
        }
      ],
      "request": {
        "method": "GET",
        "url": {
          "raw": "{{baseUrl}}/user/{{u_username}}",
          "host": [
            "{{baseUrl}}"
          ],
          "path": [
            "user",
            "{{u_username}}"
          ]
        }
      },
      "response": []
    }
  ],
  "variable": [
    {
      "key": "baseUrl",
      "value": "http://localhost:3000"
    }
  ]
}
